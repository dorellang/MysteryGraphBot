# MysteryGraphBot

**mystery**

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
**asbolutely no way**

The best way to get Mystery Graph updates via Telegram ;)

## Deploy Guide (how to run it)

This guide is written with Ubuntu 16.04 in mind, so your mileage may vary if you
want to run MysteryGraphBot on other platforms. However it shouldn't be *that*
hard to get it running on other recent Linux OSes ;)

### Getting the bot's dependencies

* Python 3.5+ is required, this already comes with Ubuntu 16.04; so you don't
    need to install nothing here :)

* You need to install Python pip package manager for the installed Python. You
    can do this in Ubuntu with the command:

        $ sudo apt-get install python-pip

* Although it's not strictly necessary, it is highly recommended to install
    `virtualenv`, so that the python packages that are required by this app are
    isolated and don't conflict with the rest of the python packages installed
    globally. Actually you'll be installing `virtualenvwrapper` which will get
    the `virtualenv` package installed, but also will give you some really nice
    command-line tools that make the python virtual environment management
    easier.

    You can get it by running this:

        $ sudo pip install virtualenvwrapper && export PROJECT_HOME=~/.virtualenvs && source /usr/local/bin/virtualenvwrapper.sh

    You'll probably want to load the virtualenvwrapper helpers at startup, so
    (assuming you have bash as your shell) you should append the following lines
    to your `~/.bashrc` file:

        export WORKON_HOME=$HOME/.virtualenvs
        source /usr/local/bin/virtualenvwrapper.sh

* Now clone this repo, `cd` to the repo dir, create a virtualenv (here called
    `MysteryGraphBot`) and install the bot's dependencies

        $ git clone https://github.com/dorellang/MysteryGraphBot.git
        $ cd MysteryGraphBot
        $ mkvirtualenv MysteryGraphBot -p `which python3`
        $ pip install -r requirements.txt

### Configuring the bot

You need to create a `mystery_graph_bot.conf` file in the working directory
where the bot will run (normally in the repo root). Fortunately we have a
sample config file that you can base your own configuration on: it's called
`mystery_graph_bot.sample.conf`, just copy it with the proper name and tailor
it to your needs:

    $ cp mystery_graph_bot.sample.conf mystery_graph_bot.conf

You can read more about the configuration file on
[its own section](#configuration-guide)

### Running the bot in the command-line

You need to use the virtualenv that has the python dependencies. If you
followed the previous steps, it should be named `MysteryGraphBot`, so let's
activate it:

    $ workon MysteryGraphBot

Now `cd` to a directory with a `mystery_graph_bot.conf` file. We have one in the
Repo directory; so enter it and run:

    $ python mystery_graph_bot

There you are :D

### Running the bot as a service

Running the bot directly on the command-line has some obvious disadvantages,
first you need to be logged in order to keep the bot running. But also if
by any reason the bot stops running then it won't restart until you do it
manually. So the best way to run the bot is as a service.

TO BE CONTINUED

## Configuration Guide

The bot's configuration is specified in a JSON file named `mystery_graph_bot.conf`
that must be placed in a file in the current working directory where the Bot is
ran from. The JSON file has the following structure:

* **token**. *String*. The Telegram token that the bot will use to connect to
    the Telegram API.

* **data\_file**. *String*. The path where the bot will save the polled data
    summary. Relative to working directory.

* **graph\_url**. *String*. The URL where the graph is polled from.

* **graph\_visualization\_url**. *String*. The URL that the bot will send to the
    chats that the users can open in their browsers to the see the visualization
    of the graph.

* **refresh\_time**. *Integer*. The number of seconds that will be between each
    polling to the graph.

* **chat\_whitelist**. *[(Integer | String)]*. The list of Telegram chat\_ids that
    the bot will try to send the graph updates to. Please note that the fact a
    chat\_id is here does not mean that the updates will be effectively sent to
    that chat. In the case of a group chat the bot must have been added to it
    and in the case of a 1-to-1 chat the targeted user must have started a
    conversation with the bot.

* **log\_file**. *String*. The path of the log file generated by the bot.
    Relative to working directory.

## TODO

* Make a Chef recipebook to make deployment trivial